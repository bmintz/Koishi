CREATE TABLE koi_test.names(
	ref BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	uid BIGINT NOT NULL,
	name TEXT NOT NULL NOT NULL,
	first_seen TIMESTAMP WITHOUT TIME ZONE DEFAULT CURRENT_TIMESTAMP);

CREATE INDEX ON names (uid);

CREATE TABLE koi_test.avatars(
	ref BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	uid BIGINT NOT NULL,
	avatar TEXT NOT NULL,
	first_seen TIMESTAMP WITHOUT TIME ZONE DEFAULT CURRENT_TIMESTAMP);

CREATE INDEX ON avatars (uid);

CREATE TABLE koi_test.avy_urls(
	hash TEXT PRIMARY KEY,
	url TEXT NOT NULL,
	msgid BIGINT NOT NULL,
	id BIGINT NOT NULL,
	size BIGINT NOT NULL,
	-- these are allowed to be null in case the embed server fails to detect the image size
	height BIGINT,
	width BIGINT);

CREATE TABLE koi_test.discrims(
	ref BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	uid BIGINT NOT NULL,
	discrim TEXT NOT NULL,
	first_seen TIMESTAMP WITHOUT TIME ZONE DEFAULT CURRENT_TIMESTAMP);

CREATE INDEX ON discrims (uid);

CREATE TABLE koi_test.nicks(
	ref BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	uid BIGINT NOT NULL,
	sid BIGINT NOT NULL,
	nick TEXT,
	first_seen TIMESTAMP WITHOUT TIME ZONE DEFAULT CURRENT_TIMESTAMP);

CREATE INDEX ON nicks (uid, sid);

CREATE TABLE koi_test.statuses(
	ref BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	uid BIGINT NOT NULL,
	status TEXT NOT NULL,
	first_seen TIMESTAMP WITHOUT TIME ZONE DEFAULT CURRENT_TIMESTAMP);

CREATE INDEX ON statuses (uid);	

CREATE TABLE koi_test.games(
	ref BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	uid BIGINT NOT NULL,
	game TEXT,
	first_seen TIMESTAMP WITHOUT TIME ZONE DEFAULT CURRENT_TIMESTAMP);

CREATE INDEX ON games (uid);

CREATE TYPE koi_test.cog_event AS ENUM ('cog_offline', 'cog_online');

CREATE TABLE koi_test.cog_log(
	ref BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	event cog_event NOT NULL,
	time TIMESTAMP WITHOUT TIME ZONE DEFAULT CURRENT_TIMESTAMP);

-- for users that the bot cannot see at all
CREATE TABLE koi_test.member_removes(
	ref BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	uid BIGINT NOT NULL,
	time TIMESTAMP WITHOUT TIME ZONE DEFAULT CURRENT_TIMESTAMP);
